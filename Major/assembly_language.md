---
title: 汇编语言
date: 2020-5-9
tags: 汇编语言
mathjax: true
---

## 基础知识

- 地址总线
    - CPU通过地址总线来指定存储单元，N根导线可以传送N位二进制数，可选址$2^N$个内存单元，可表示最大的数为$2^N - 1$。
- 数据总线
    - CPU与内存或其他器件之间的数据传输是通过数据总线来进行的。数据总线的宽度决定了CPU和外界的数据传输速度。如8根数据总线一次可以传送8位(一个字节)二进制数据。
- 控制总线
    - CPU对外部器件的控制是通过控制总线来进行的。有多少跟控制总线就意味着CPU提供了对外部器件的多少种控制。
- 主板
    - 主板上有核心器件和一些主要部件，这些部件通过总线(地址总线、数据总线、控制总线)相连
- 接口卡
    - CPU通过总线向接口卡发送命令，接口卡根据CPU的命令控制外设进行工作
- 各类储存器芯片
    - 从读写属性上分为两类：随机储存器(RAM)和只读储存器(ROM)
        - 随机储存器可读可写，关机后储存的内容丢失
        - 只读储存器只读不能写入，关机后内容不会丢失
- 地址空间
    - 内存地址空间的大小受CPU地址总线宽度的限制，如CPU地址总线宽度是20,可以传送$2^{20}$个不同的地址信息。可定位$2^20$个内存单元，该CPU的内存地址空间大小为1MB


## 寄存器

寄存器是CPU中程序员可以用指令读写的部件。不同的CPU寄存器的个数、结构是不同的。8086CPU有14个寄存器，每个寄存器有一个名字。这些寄存器是：AX、BX、CX、DX、SI、DI、SP、BP、IP、CS、SS、DS、ES、PSW。


### 通用寄存器

8086CPU的所有寄存器都是16位的，可以储存两个字节。AX、BX、CX、DX这4个寄存器通常用来存放一般性数据，被称为 **通用寄存器** 。这4个寄存器可以分为两个独立使用的8位寄存器来使用:
- AX可分为AH和AL
    - AX的低8位构成了AL寄存器，高8位构成了AH寄存器，后面的同理
- BX可分为BH和BL
- CX可分为CH和CL
- DX可分为DH和DL


### 几条汇编命令

| 汇编命令  | 控制CPU完成的操作                  | 用高级语言的语法描述 |
|-----------|------------------------------------|----------------------|
| mov ax,18 | 将18送入寄存器AX                   | AX=18                |
| mov ax,bx | 将寄存器bx的数据送入寄存器AX       | AX=BX                |
| add ax,18 | 将寄存器AX的数值加上18             | AX=AX+18             |
| add ax,bx | 将寄存器AX的数值加上寄存器BX的数值 | AX=AX+BX             |


### 物理地址

CPU访问内存单元时，要给出内存单元的地址。所有的内存单元构成的存储空间是一个一维的线性空间，每个内存单元在这个空间中都有唯一的地址，我们将这个唯一的地址称为物理地址。


### 16位结构的CPU

特征：
- 运算器最多可处理16位的数据
- 寄存器的最大宽度为16
- 寄存器和运算器之间的通路为16位


### 8086CPU给出物理地址的方法

8086CPU有20位地址总线，可以传送20位地址。8086CPU又是16位结构，在内部一次性处理、传输、暂时储存的地址为16位。

8086CPU采用一种在内部用两个16位地址合成的方法来形成一个20位的物理地址

8086CPU读写内存的过程如下：
- 1. CPU中相关部件提供两个16位的地址，一个称为段地址，另一个称为偏移地址
- 2. 段地址和偏移地址通过内部总线接入一个称为地址加法器的部件
- 3. 地址加法器将两个16位地址合成一个20位的物理地址
- 4. 地址加法器通过内部总线20位物理地址送入输入输出控制电路
- 5. 输入输出控制电路将20位物理地址送上地址总线
- 6. 20位物理地址被地址总线传送到储存器

地址加法器采用 **物理地址=段地址×16+偏移地址** 的方法合成物理地址。如1230+00C8=12300+00C8=123C8(十六进制表示)


### "物理地址=段地址×16+偏移地址"的本质含义

本质含义是：CPU在访问内存时，用一个基础地址(段地址×16)和一个相对于基础地址的偏移地址相加，给出内存单元的物理地址。(有点类似计网中的网段)


### 段的概念

其实内存没有分段，段的划分来自于CPU，如我们可以认为地址10000H~100FFH的内存单元组成一个段，基础地址为10000H，段地址为1000H;我们也可以认为10000H~10007FH、10080H～100FFH的内存单元为两段，基础地址为10000H和10080H，段地址为1000H和1008H。

在编程时根据需要，将若干地址连续的内存单元看作一个段。


### 段寄存器

8086CPU在访问内存时要由相关部件提供内存单元的段地址和偏移地址，送入地址加法器合成物理地址。段地址在8086CPU的段寄存器中存放。8086CPU有4个段寄存器：CS、DS、SS、ES。


### CS和IP

CS和IP是8086CPU中最关键的两个寄存器，它们指示了CPU当前要读取指令的地址。CS为代码段寄存器，IP为指令指针寄存器。

在8086PC机中，设CS中内容为M，IP中内容为N，8086CPU将从内存M×16+N单元开始，读取一条命令并执行。过程如下

- 1. 8086CPU当前状态：CS中内容为2000H，IP中内容为0000H
- 2. 内存20000H～20009H单元中存放着的机器码对应的汇编指令如下：
    - 地址：20000H～20002H，内容：B8 23 01，长度：3Byte，对应汇编指令：mov ax，0123H
    - 等等
- 3. CS和IP寄存器的内容传入地址加法器合成物理地址20000H
- 4. 输入输出控制电路将物理地址20000H送上地址总线
- 5. 从内存20000H单元开始存放的机器指令B8 23 01通过数据总线送入CPU
- 6. 输入输出控制电路将机器指令B8 23 01送入指令缓冲器
- 7. IP中的值根据指令长度自动增加
- 跳转到第1步，重复这个过程

CPU工作的时候把有的信息看作指令，有的信息看作数据，那CPU根据什么将内容中的信息看着指令？
- CPU将CS:IP指向的内存单元中的内容看作指令，因为，在任何时候，CPU将CS、IP中的内容看作指令的段地址和偏移地址，来在内存中读取指令码










