---
title: communication and networking笔记
date: 2021-03-24
tags: 
- network
mathjax: true
---

# TODO第二章

# 数据和信号

## 模拟与数字

- 模拟数据：连续状态的信息
- 数字数据：离散状态的信息


- 复合信号
    * 单一正弦波在数据通信中没有作用，我们需要发送复合信号，复合信号由许多简单正弦波组成
    * **基础频率或第一谐波**：频率与复合信号一样的正弦波
    * **第N谐波**：频率是基础频率的N倍

- 带宽：**复合信号的带宽是信号最高频率和最低频率的差值**

- 数字信号：
    * 一个有L个电平的信号可以表示$log_2L$个位

如有4个电平，可以表示2个位：

```
电平
4    11
3    10
2    01
1    00
```

- **比特率**：一秒钟发送的位数，单位：**每秒位(bps)**
- 位长：一个位在传输介质上的距离
    * 位长=传播速度x位持续时间


### 数字信号的传输

数字信号是无穷大带宽的复合模拟信号。两种方法传输数字信号：基带传输和宽带传输

#### 基带传输

todo p59

基带传输通过通道发送数字信号，不转换成模拟信号


#### 宽带传输

todo

宽带传输或调制把数字信号转变为模拟信号。调制允许我们使用 **带通通道** ，即带宽不从0开始的通道。


## 传输减损

- 衰减
    * 克服介质的阻抗需要放热，能量损失，需要使用信号放大器放大
    * **分贝(dB)** 用于计算两种信号或同一信号在不同位置直接的相对强度
    * 功率表示：$dB = 10 \log_{10} \frac{P2}{P1}$
    * 用电压表示：$dB = 20 \log_{10} \frac{V2}{V1}$
- 失真
    * 不同频率成分在介质中有自己从传播速度，在终点时有各自的延迟
- 噪声
    * **信噪比SNR**
    * $SNR = \frac{平均信号功率}{平均噪声功率}$ 是功率比
    * 用分贝描述：$SNR_{dB} = 10 \log_{10} SNR$
    * 如果`SNR+1几乎与SNR相当`，则$log_2(1+SNR) \approx \frac{SNR_{dB}}{3}$


## 数据速率限制
### 无噪声通道：奈奎斯特比特率

对于无噪声通过，**理论上最大比特率**：

$$比特率 = 2 \times 带宽 \times \log_2 L$$

但是如果电平数L很大，接收方会很难区分不同电平，从而削弱系统可靠性。**电平数应该是2的幂** 


### 噪声通道：香农容量定理

**噪声通道理论上的最高数据传输速率**：

$$通道容量 = 带宽 \times \log_2 {(1+SNR)}$$

无论使用多少个电平，都不可能获得比通道容量更高的数据速率


### 两者结合

todo

**香农容量定理给出了数据速率的上限，奈奎斯特公式给出所需的电平数** 

eg: 


## 性能

- 带宽
    * 以赫兹衡量：即复合信号的频率范围，即通道能通过信号的频率范围
    * bps衡量：每秒发送的位数
    * todo  p70

- 吞吐量
    * 吞吐量是发送速率的**实际衡量值**，带宽是链路的潜在衡量值


- 延迟 = 传播时间+传输时间+排队时间+处理时间
    * 传播时间 = 距离 / 传播速度
        + 一个位从源到目的的用时
    * 传输时间 = 报文长度 / 带宽
        + 从报文第一个位到达到最后一个位到达的用时
    * 排队时间
- 带宽与延迟的乘积 = 充满链路的位的个数 todo p72


# 数字传输

- 数字数据：存储在计算机中的数据
- 数字信号：数据在链路中传播的形式


## 线路编码：数字信号到数组信号转换

将数字数据转换为数字信号的过程

- 数据元素(date element)：位
- 信号元素(signal element)：**数据元素的载体** ，我们传输不会一次只传输一位(电平L能传$log_2 L$个位)
- 比率r：每个信号元素承载的数据元素的数量
- 数据速率(data rate)：**S** (单位bps) todo
- 信号速率(signal rate)：**B** (单位波特率baud rate/脉冲速率/调制速率) todo

数据速率相当于一辆车的载货能力，信号速率相当于公路上行驶的车辆数目，由于宽带有限，信号速率低一点，数据速率应该高一点。

**信号元素计算公式**

$$S = c \times N \times \frac1r (baud)$$

其中S表示信号元素数，c表示具体情况的情形因子，N表示数据速率，r表示比率

> **例**：
>
> 最小带宽可以由上式子得出： $B_{min} = c \times N \times \frac1r (baud)$
> 
> 既然最小带宽，那一定是从0开始算才最小嘛(低通)，每个频率能送一个种信号元素，那S个信号元素就是最小带宽啦


### 基线偏移

- **基线**：收到的信号功率的运行平均值
    * 接收方将输入与基线比较来**确定数据元素的值**
- **基线偏移**：显然，连续的0或1会引起信号功率的平均值发生变化，称为 **基线偏移** 
- **DC问题**：连续的0或1说明电平不变，即频率很低，接近直流，给非低通带来传输问题
- 自同步：接收方应与发送方的 **位间隔** 对应，这样才能正确的解析
    * 如发送方一秒只发送1位，而接收方一秒接受2位，那信号由`x 变为了 xx`
    * 可以在传输的数据中保存定时信息来实现自同步


### 线路编码方案

#### 不归零(NRZ)

定正表示1，负表示0，**位中间不归零**


##### 单极编码

所有信号电平只在时间轴的一边，要么大于等于0，要么小于等于0


##### 极性编码

信号电平可以在时间中的两边


##### 极性不归零

- NRZ-L(NRZ电平编码)：电平决定位值
- NRZ-I(NRZ反向编码)：没有跳变位值是0，有跳变位值是1
- 基线偏移问题
    * NRZ-L：全0或全1时，存在基线偏移问题，存在DC问题
    * NRZ-I：全0时，存在基线偏移问题，存在DC问题
- 方案分析：
    * 有较号的信号速率
    * 缺点：如果极性改变(如双绞线意外改变)，NRZ-L会把0解释为1，把1解释为0


#### 归零编码(RZ)

当NRZ发生不同步时，接收方不知道一位合适结束，下一个何时开始，因此引入归零编码。

RZ编码使用三个值：正、负、0，电平信号 **可以在位中变化**，但是存在以下缺点：

- 方案分析：存在的问题
    * 要两个信号编码一位，需要更大的带宽
    * 同RZ编码，极性改变会导致0和1的误判
    * 用三个电平表示，生成和分辨的成本都提高了
    * **所有不再使用了** 由双相编码替代


#### 双相编码：曼彻斯特编码和差分曼彻斯特编码

双相编码利用了RZ的思想和NRZ的思想

<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/Bi-Phase_Space.jpg" width="50%" align="right"/>

**位中间总是发生跳变**

- **曼彻斯特编码** : RZ+NRZ-L
    * 前半电平保持一个水平，后半电平变为另一个水平，位中间是跳变的，但是没有0位
- **差分曼彻斯特编码** ：RZ+NRZ-I
    * 位值开始时确定一个值。如果下一位0，位中**跳变后不跳回**；如果下一位是1，位中**跳变后跳回**原位。
- 分析
    * 解决基线问题：每位中间总是跳变
    * DC问题：无DC成分
    * 自同步：中间的跳变可以用来同步间隔
    * 信号速率较NRZ差


#### 双极性方案：多电平二进制

一个数据元素的电平是0，另一个元素的电平在正负值间**交替**

<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/AMI.jpg" width="50%" align="right"/>

- **AMI(交替传号反转编码)** ：传号指的是1，表示交替的1的反应
    * 0是用电位0表示，下一个1的电位是最后一个1的电位的反，即交替。
        + 如最后一个1电位是-1，则下一个1电位是1
- 伪三元编码：AMI的变型
    * 1是用电位0表示，下一个0的电位是最后一个0的电位的反，即交替。
- 方案分析
    * 双极方案是NRZ的替代，信号速率相同，但不存在DC成分


#### 多电平方案 todo： redo

实际线路中我们想要增加数据速率，降低信号速率。因此多点平方案的目标就是将m个数据元素的模式编码成n个信号元素模式，**增加波特的位数**。

如果m位数据元素只有0，1两种，则有$2^m$种组合。

不同信号可以用不同电平表示，如果有L个不同电平，就有$L^n$种信号模式。

如果$2^m < L^n$数据模式只占信号模式的子集，$2^m > L^n$数据编码不可能。

- 用`mBnL`表示不同的编码类型
    * m表示二进制模式的长度，一般用数字
    * B表示二进制数据，一般用字母(B表示2，T表示3，Q表示4...)
    * n表示信号模式长度，一般用数字
    * L表示信号电平，一般用字母

todo

##### 2B1Q方案

<div align=center><img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/2B1Q.jpg" width="60%"/></div>


##### 8B6T方案
##### 4D-PAM5方案
##### 多线路传输：MLT-3

<div align=center><img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/summary_of_line_coding.jpg" width="100%"/></div>


### 块编码

把m位块变为n位块，n\>m，给出一些**冗余来做同步和差错检查等功能**。也称为 **mB/nB编码** ，B表示二，故一般是二元的。

- 步骤
    * 1. 分组：分成许多m位编码的组
    * 2. 置换：每组用对应的n位编码替换m位编码
        + n编码往往设计得有特殊的功能
    * 3. 组合：用n位的组组成新的流

发送方将mB映射成nB编码发送，接收方收到后再由nB反映射成mB解码。


#### 4B/5B方案：4个二元变5个二元

4B/5B与NRZ-I组合使用，NRZ-I很好的信号速率，但是存在全0时的同步问题。一种解决方案就是在**使用NRZ-I编码前4B/5B改变位流**

4B/5B的解决方案：4B/5B的编码性质是前导0不会超过1个，后缀的0不超过两个，因此任意两组组合最多有3个连续的0。有$2^5 - 2^4 = 16$个的冗余可以用来检错和控制。再多余的，收到的话就说明传输出错。

<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/map_of_4B5B.jpg" width="60%" align="right"/>

- 方案分析
    * 增加了NRZ-I的信号速录：4 to 5，1.25倍，但优于两相方案
    * 解决了NRZ-I在全0时的同步问题
    * 没有解决DC问题，还是有连续不变的信号的


#### 8B/10B方案

类似4B/5B方案，有更强的检错和控制能力。当然还做了些优化：

- 高5位用5B/6B，低3位用3B/4B
    * 组合使用，简化映射表
- 为防止连续0和连续1，编码使用不均等性控制器
    * 如果观察到0比1多，那么当前块的所有位取反，即提供了不均等信检错


### 扰动

由于带宽要求，两相编码不适用于长距离通信。块编码和NRZ线路编码存在DC问题，也不适用于长距离编码。双极编码AMI有窄带宽且没有DC成分，但是存在连续0的不同步问题。因此，**如果避免了AMI的连续0就能让AMI适用于长距离**。

**扰动就是一种不增加位数并提供同步，一种把0电平脉冲置换成其他电平组合的来提供同步的技术**。系统基于定义好的扰动规则插入所需脉冲。两种通用扰动技术：B8ZS和HDB3


#### B8ZS：8零置换的双极编码方案

8个连续的0电平会被替换成`000VB0VB`

- V表示违反，要**违反AMI的编码规则给出非零电平**(因为之前说是改造AMI嘛)
- B表示双极，表示要与**AMI规则相一致给出非零电平**(1交替/传号交替)
- 简记：V与前一个非零脉冲相同极性，B与前一个非零脉冲(V)相反极性

如

```
     1 | 0 | 0 | 0 | 0 | 0  | 0 | 0  | 0
       |   |   |   |   |    |   |    | 
       |   |   |   |   |    |   |    | 
     1 | 0 | 0 | 0 | 1 | -1 | 0 | -1 | 1
                     V   B        V    B
                     ^
违反，最后一个非零是1，根据AMI应该是-1。故称违反
```

- 方案分析
    * 平衡了正负电平，维持了DC平衡


#### HDB3

比B8ZS技术更保守， **4个连续零置换，被置换为000V或B00V**，两种不同置换方式是为了**维持每次置换后非零脉冲为偶数**

- 置换规则
    * 之前的(包括之前的置换后)非零脉冲数是奇数，则用000V，奇变偶
    * 之前的非零脉冲数是偶数，则用B00V，保持偶

<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/HDB3.jpg" width="50%"/>


## 模拟信号到数字信号转换

主要有两种技术：脉冲码调制(PCM)和delta调制

### 脉冲码调制(PCM)

- 过程
    * 对模拟信号进行**采样**
    * 对采用后的信号进行**量化**
    * 对量化后的值**编码**成位流


#### 采样

- 采样率(sampling rate)：每隔$T_s$秒采样，则$\frac{1}{T_2}$称为采样率/采样频率
- 采用过程有时称为 **脉冲振幅调制** 

显然为了能够还原原始信号，采样率应有所要求。 **奎奈斯特定理：** 一个必要条件是**采样速率(sampling rate)至少是原始信号中最高频率的两倍**

- $f_s = 2 \times f_{max}$称为**奎奈斯特速率**
- $f_s = 4 \times f_{max}$称为2倍奎奈斯特速率


#### 量化

采样得到的值可能无限介于某个区间，都不相同，无法用于编码，因此需要量。

- 过程
    * 1. 假定原始模拟信号瞬间振幅介于$V_{min}$和$V_{max}$
    * 2. 把范围划分为L个区，每个区间高度$(Delta)\Delta = \frac{V_{max}-V_{minf}}{L}$
    * 3. 分配0-L-1的量化值到每个区的中点
    * 4. 样本振幅近似为量化值
- 定义
    * 量化等级：L(等级数)取决于模拟信号振幅和我们需要准确恢复的程度
    * 量化误差(标准化误差)：标准化量化值 - 标准化PAM值
    * 标准化PAM值(振幅)：$实际振幅/\Delta$
    * 标准化量化值：标准化PAM值所在区间区间的中间值
    * 量化码：对量化电平编码

<div align=center><img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/PCM.jpg" width="60%"/></div>

量化误差改变了信号的信噪比，根据香农理论，这减小了上限容量。**量化误差对信号$SNR_{dB}$的影响缺绝于量化级别L或每个样本的位数$n_b$** 

$$SNR{dB} = 6.02n_B + 1.76 dB$$

> 显然分得越细，量化误差越小，信噪比越高

在实际生活中，模拟信号对振幅的贡献是不均匀的，即振幅变化时快时慢。振幅变化一般在低频中比在高频中发生更加频繁。因此使用 **非均匀量化** 更好，即$\Delta$的值是不固定的，接近低振幅时较大，而接近高振幅时较小。


#### 编码

- 每个样本的位数取决于量化等级：$位数n_s = log_2 L$
- $比特率 = 采样率 \times 每个样本位数 = f_s \times n_b$


#### 原信号恢复

需要使用PCM解码器，其将码字转换成阶梯信号，然后后通过一个低通滤波器将阶梯信号平滑成模拟信号

> 信号光滑时，高频分量较少


#### PCM带宽

要数字化一个给定的低通模拟信号，则这个数字信号的通道的最小带宽是多少？

$$B_{min} = n_b \times B_{analog}$$

**数字信号的最小带宽是模拟信号的$n_b$倍，这就是数字化的代价**


#### 信道的最大数据率

前面说了奈奎斯特定理: $N_{max} = 2 \times B \times log_2L$

- 证明
    * 带宽B，低通
    * L电平，每个电平一个信号元素：$r = \frac1{log_2L}$
    * 数据信号过低通，截去BHz以上
    * 以2xB采样，L个电平量化
    * 所以$N = f_s \times n_b = 2 \times B \times log_2L$


所以，最小所需带宽:

$$B_{min} = \frac{N}{2 \times log_2L} Hz$$


### Delta调制(DM)

PCM复杂，为了减小复杂性，所有需要DM

- 比较
    * PCM：根据每个样本的振幅变化
    * DM：根据与前一个样本的比较，记录正负值的改变，称为 delta $\delta$
        + 如delta正记录为1
- 调制器
    * 将当前模拟信号的值与前一个梯形信号的值比较，转换成梯形信号
- 解调器
    * 根据数字信号产生梯形信号，再平滑处理
- 适配DM
    * 不同模拟信号的振幅变化率不同，故delta值应随不同信号改变
- 量化误差
    * 多少也会存在量化误差


<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/DM.jpg"/>


## 传输模式

一次发送一位还是多位分组发？分组发又该怎么分组？


### 并行传输

每次发n位：用n条线传n位。高速，但贵。仅适用短距离传输。


### 串行传输

一次传输一位，成本是并行传输的1/n。设备内部是并行的，发送要将并行转成串行，接收要转换成并行。

有三种方式

#### 异步传输

遵循一定的传输规则，每个字节开头包含一个起始位(0)，末尾包含一个个或多个停止位(1)。字节间添加一些时间间隙。

- 特点
    * 速度慢，由于时间间隙存在。一般用于键盘输入等
    * 一帧短，需要保证同步是只有一小段(一字节)

<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/async_trans.jpg"/>


#### 同步传输

发送位流而不包含起始位、停止位、时间间隙。接收方负责分组工作。需要接收方有较高的计时能力。

- 特点
    * 速度快
    * 一帧更长

<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/sync_trans.jpg"/>


#### 等时传输

帧间时间延时不等是不可接受的，如音频视频等。必须整个流同步，保证以固定速率到达。


# 模拟传输

> 数字信号好处多，但是是低通信号，而实际链路只能传输带通信号，所以只能传输模拟信号。

## 数字到模拟

- 原理
    * 一个复杂信号可以是多个简单信号(三角信号集)的线性组合。而决定三角信号集的可以有振幅、频率、相位。因此改变其中任意一个信号都会有所不同，于是有三种转换机制
        + 幅移键控(ASK)
        + 频移键控(FSK)
        + 相移键控(PSK)
- 几个概念
    * 数据元素
        + 同数字传输
    * 信号元素
        + 与数字传输有所不同
    * 波特率：每秒发送的信号元素
        + $S = N \times \frac1r 波特$
        + N表示数据速率(bps)
        + r是一个信号元素携带的数据元素数量，**模拟传输中$r = log_2L$，L是信号元素类型** 
    * 比特率：每秒发送的位数。**数字数据模拟传输中波特率小于等于比特率**
    * 带宽B
        + 除了FSK外，B都与信号速率正比
        + FSK要加上载波频率直接的差值
    * 载波信号
        + (调制定理)使用一个高频信号作为基波，来承载信号，称为载波信号carry signal
        + **数字信息通过改变载波的一个或多个特性(振幅、频率、相位)在调试载波信号，称为调制或移动键控**


### 幅移键控(ASK)

通过改变载波信号的幅值来生成信号元素。


#### 二进制ASK(BASK)

信号元素只有两种电平，称为BASK或开关键控(OOK)。一个电平Am=0，另一个与载波相同。

<img src="https://raw.githubusercontent.com/66RING/66RING/master/.github/images/Notes/Major/communication_and_networking/BASK.jpg" width="50%" align="right"/>

- ASK带宽: $B = (1+d) \times S$
    * 因子d与调制和过滤处理有关
    * S=N
- 实现
    * 通过振荡器产生载波信号
    * 使用乘法器将数字信号乘以载波信号
- 多电平ASK
    * 多个振幅，每次使用多位调制


### 频移键控(FSK)

todo

## 模拟到模拟(低通变带通)




























