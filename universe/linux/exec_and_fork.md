---
title: Fork & Exec in Linux
date: 2020-7-18
tags: tools, linux, fork, exec
---

在linux中启动新一个程序有两种方式：
- Fork(分叉)
    * 创建一个新的进程，该进程几乎是前一个进程的拷贝
    * 子进程和父进程使用相同的代码段，子进程复制父进程的堆栈段和数据段
    * 子进程对父进程的复制采用 **写时复制** 的策略，所有实际上物理空间还是共享着的，直到一个进程写了数据，才将有差别的"页"从物理地址上分开
- Exec
    * 启动另外的进程以取代当前运行的进程
    * 调用exec的进程将会死亡，废弃原有的数据段和堆栈段，分配新的数据段和堆栈段，**但是进程号是同一个** 。所以对于系统来说还是同一个进程，但不是同一个程序了


## 实战

- 一般使用`fork()`函数新建一个进程，然后让进程去执行`exec`调用
- 在命令中修改文件描述符时(如重定向，关闭fd等)，命令执行结束时描述符就会自动还原。可以通过`exec`执行
    * 如`exec 2>/dev/null`，那么直到shell退出，2(标准错误)都一直会为`/dev/null`

