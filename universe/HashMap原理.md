---
title: HashMap原理
date: 2020-6-27
tags: java, hashmap
---

hashmap有数组+链表组成

```
| array | 1 | 2 | ... | N |
|-------|---|---|-----|---|
  |       |   |   |     |   
  |       |   |   |     |   
 链表   value
  |       |   |   |     |   
  |       |   |   |     |   
        value
  |       |   |   |     |   
  |       |   |   |     |   
```

- hashmap初始化数组容量的时候必须的一个二的幂次方数
    * 这样方便控制取值范围
    ``` 
    2^k-1会得到一个全是1的二进制数：0001 1111
    用这个数与hash code与运算即可以截断hash code，只保留低位k-1位
    0000 0111
    0101 1010
    ---------
    0000 0010
    
    高位数先右移在与这个111与运算就可得到想要的任意位
    提高散列性，防止链表过长，提高get的效率
    ```

取小于一个数的最大二次幂算法：

```
func (int i){
    i |= (i >> 1)
    i |= (i >> 2)
    i |= (i >> 4)
    i |= (i >> 8)
    i |= (i >> 16)
    return i-(i >>> 1)
}

return前的一系列移位操作把有效位全部变成了1
在用结果减去移1位后的结果(i>>>1)，就得到只有最高位为1


        0001 ****
>>1      0000 1***
        ---------
        0001 1***
>>2     0000 0110
...直到int的64位都保
        0001 1111
        0000 1111
    res
```


